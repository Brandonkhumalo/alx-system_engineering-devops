#!/usr/bin/env bash
# Installs Nginx and configures it to add a custom X-Served-By HTTP header with the hostname

# Install Nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Get the hostname of the server
hostname=$(hostname)

# Create a backup of the default config if it doesn't already exist
default_config="/etc/nginx/sites-available/default"
backup_config="/etc/nginx/sites-available/default.bak"
[ ! -f "$backup_config" ] && cp "$default_config" "$backup_config"

# Insert the custom header into the server block if not already present
if ! grep -q "add_header X-Served-By" "$default_config"; then
    sed -i "/^\s*location \/ {/a \\tadd_header X-Served-By \"$hostname\";" "$default_config"
fi

# Restart Nginx to apply the changes
service nginx restart
